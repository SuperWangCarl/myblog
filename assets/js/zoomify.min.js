(function(a){Zoomify=function(c,b){var d=this;this._zooming=false;this._zoomed=false;this._timeout=null;this.$shadow=null;this.$image=a(c).addClass("zoomify");this.options=a.extend({},Zoomify.DEFAULTS,this.$image.data(),b);this.$image.on("click",function(){d.zoom()});a(window).on("resize",function(){d.reposition()});a(document).on("scroll",function(){d.reposition()})};Zoomify.DEFAULTS={duration:200,easing:"linear",scale:0.9};Zoomify.prototype.transition=function(b,c){b.css({"-webkit-transition":c,"-moz-transition":c,"-ms-transition":c,"-o-transition":c,transition:c})};Zoomify.prototype.addTransition=function(b){this.transition(b,"all "+this.options.duration+"ms "+this.options.easing)};Zoomify.prototype.removeTransition=function(b,d){var c=this;clearTimeout(this._timeout);this._timeout=setTimeout(function(){c.transition(b,"");if(a.isFunction(d)){d.call(c)}},this.options.duration)};Zoomify.prototype.transform=function(b){this.$image.css({"-webkit-transform":b,"-moz-transform":b,"-ms-transform":b,"-o-transform":b,transform:b})};Zoomify.prototype.transformScaleAndTranslate=function(d,c,b,e){this.addTransition(this.$image);this.transform("scale("+d+") translate("+c+"px, "+b+"px)");this.removeTransition(this.$image,e)};Zoomify.prototype.zoom=function(){if(this._zooming){return}if(this._zoomed){this.zoomOut()}else{this.zoomIn()}};Zoomify.prototype.zoomIn=function(){var i=this,e=this.$image.css("transform");this.transition(this.$image,"none");this.transform("none");var g=this.$image.offset(),c=this.$image.outerWidth(),o=this.$image.outerHeight(),j=this.$image[0].naturalWidth||+Infinity,l=this.$image[0].naturalHeight||+Infinity,h=a(window).width(),k=a(window).height(),n=Math.min(j,h*this.options.scale)/c,m=Math.min(l,k*this.options.scale)/o,f=Math.min(n,m),d=(-g.left+(h-c)/2)/f,b=(-g.top+(k-o)/2+a(document).scrollTop())/f;this.transform(e);this._zooming=true;this.$image.addClass("zoomed").trigger("zoom-in.zoomify");setTimeout(function(){i.addShadow();i.transformScaleAndTranslate(f,d,b,function(){i._zooming=false;i.$image.trigger("zoom-in-complete.zoomify")});i._zoomed=true})};Zoomify.prototype.zoomOut=function(){var b=this;this._zooming=true;this.$image.trigger("zoom-out.zoomify");this.transformScaleAndTranslate(1,0,0,function(){b._zooming=false;b.$image.removeClass("zoomed").trigger("zoom-out-complete.zoomify")});this.removeShadow();this._zoomed=false};Zoomify.prototype.reposition=function(){if(this._zoomed){this.transition(this.$image,"none");this.zoomIn()}};Zoomify.prototype.addShadow=function(){var b=this;if(this._zoomed){return}if(b.$shadow){b.$shadow.remove()}this.$shadow=a('<div class="zoomify-shadow"></div>');a("body").append(this.$shadow);this.addTransition(this.$shadow);this.$shadow.on("click",function(){b.zoomOut()});setTimeout(function(){b.$shadow.addClass("zoomed")},10)};Zoomify.prototype.removeShadow=function(){var b=this;if(!this.$shadow){return}this.addTransition(this.$shadow);this.$shadow.removeClass("zoomed");this.$image.one("zoom-out-complete.zoomify",function(){if(b.$shadow){b.$shadow.remove()}b.$shadow=null})};a.fn.zoomify=function(b){return this.each(function(){var d=a(this),c=d.data("zoomify");if(!c){d.data("zoomify",(c=new Zoomify(this,typeof b=="object"&&b)))}if(typeof b=="string"&&["zoom","zoomIn","zoomOut","reposition"].indexOf(b)>=0){c[b]()}})}})(jQuery);